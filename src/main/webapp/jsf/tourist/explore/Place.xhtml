<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" 
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:navbar="http://xmlns.jcp.org/jsf/composite/components/navbar" 
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets" 
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:map="http://xmlns.jcp.org/jsf/composite/components/map">
    <h:head>
        <title>#{chosenPlaceBean.selectedPlace.name}</title>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <h:outputStylesheet library="css" name="styles.css" />
        <h:outputStylesheet library="css" name="primeflex.min.css" />
        <p:importConstants type="com.tlt.constants.UrlConstants" var="uc" />
        <f:loadBundle basename="properties.config" var="conf"/>
        <script src="https://maps.google.com/maps/api/js?key=#{conf.MAPS_API_KEY}"></script>
        <p:importConstants type="com.tlt.constants.UrlConstants" var="uc"/>
        <style>
            .bg-blend{
                position: relative;
                background-color: rgba(0,0,0,0.5);
                height: 40vh;
                width: 100%;
            }
            .bg-blend::before{
                content: "";
                background: url(../../../uploads/places/#{chosenPlaceBean.selectedPlace.images}) no-repeat center center/cover;
                position: absolute;
                top: 0;
                left: 0;
                height: 40vh;
                width: 100%;
                z-index: -1;
                background-blend-mode:darken;
                overflow: hidden
            }
            body .ui-tabs .ui-tabs-panels .ui-tabs-panel{
                padding: .7rem 0px 0px 0px;
            }
            .custom-button{
                color: white !important;
                background-color: transparent !important;
                border: 2px solid white !important;
                transition: all .3s ease !important;
                padding: .2rem 1rem;
                font-size: 1.2rem !important;
            }
            .custom-button:hover, .custom-button:focus{
                background-color: white !important;
                color: #9C27B0 !important;
            }
            .w-full > input{
                width: 100% !important;
            }

            .legend {
                display: inline-block;
                border-radius: .25rem;
                vertical-align: sub;
                padding: 1rem 1.2rem;
                width: 100%;
                border: 2px solid #ddd;
                border-radius: 1rem;
            }
            .legend:hover, .legend:focus{
                border: 2px solid #9C27B0;
                border-radius: 1rem;
            }
            .field-radiobutton .ui-outputlabel.ui-widget{
                width: 100%
            }
            span[aria-checked="true"] .ui-outputlabel > .legend{
                border: 2px solid #9C27B0;
                border-radius: 1rem;
                background-color: #c85bdb1f;
            }
        </style>
    </h:head>
    <h:body>
        <navbar:tourist-navbar user="#{touristBean.userMaster}" sideNavigationBean="#{navigationBean}"/>
        <div class="bg-blend">
            <div class="container">
                <div class="flex flex-column justify-content-center text-white mx-4" style="height:40vh">
                    <div class="text-6xl">#{chosenPlaceBean.selectedPlace.name}</div>
                    <div class="text-xl">#{chosenPlaceBean.selectedPlace.description.substring(0, chosenPlaceBean.selectedPlace.description.indexOf('.'))}</div>
                    <div class="mt-4"><h:form><p:commandButton value="Explore now" class="text-lg rounded-button ui-button-raised custom-button" action="#{reservePlace.openReservationModal(param.place)}"/></h:form></div>
                </div>
            </div>
        </div>
        <div class="container mt-4 p-2">
            <div class="grid mx-2">
                <div class="col-12 md:col-6 map-view overflow-auto align-content-end">
                    <map:place-map mapModel="#{mapBean.simpleModel}" marker="#{mapBean.marker}" markerSign="${chosenPlaceBean.currentUser.profileImage}" lat="#{chosenPlaceBean.selectedPlace.latitude}" lng="#{chosenPlaceBean.selectedPlace.longitude}" style="height: 350px; width: 400px; margin: 0px auto"/>
                </div>
                <div class="card col-12 md:col-6">
                    <h:form>
                        <p:tabView activeIndex="#{chosenPlaceBean.activeTabIndex}">
                            <p:tab title="Description">
                                <div class="about">
                                    <div class="text-lg flex justify-content-start my-4"><span class="material-symbols-outlined mr-2">info</span> #{chosenPlaceBean.selectedPlace.description}</div>
                                    <div class="text-lg flex justify-content-start my-4"><span class="material-symbols-outlined mr-2">pin_drop</span> #{chosenPlaceBean.selectedPlace.address}</div>
                                    <div class="text-lg flex justify-content-start my-4"><span class="material-symbols-outlined mr-2">schedule</span><b class="mr-2">Opening time:</b> #{chosenPlaceBean.openingTime}</div>
                                    <div class="text-lg flex justify-content-start my-4"><span class="material-symbols-outlined mr-2">schedule</span> <b class="mr-2">Closing time:</b> #{chosenPlaceBean.closingTime}</div>
                                    <div class="text-lg flex justify-content-start my-4"><span class="material-symbols-outlined mr-2">category</span> <b class="mr-2">Type:</b> #{chosenPlaceBean.selectedPlace.categoryId.name}</div>
                                    <div class="text-lg flex justify-content-start my-4"><span class="material-symbols-outlined mr-2">distance</span> <b class="mr-2">Distance:</b> #{chosenPlaceBean.distance}</div>
                                    <div class="text-lg flex justify-content-start my-4"><span class="material-symbols-outlined mr-2">directions_car</span> <b class="mr-2">Duration:</b> #{chosenPlaceBean.duration}</div>
                                </div>
                            </p:tab>
                            <p:tab title="Guides" class="px-0 pt-2">
                                <div class="grid" style="min-height: fit-content;max-height: 800px; overflow: auto">
                                    <h:outputText styleClass="text-lg text-gray-600 font-semibold" value="No guide is available for this place" rendered="#{chosenPlaceBean.guidsOfPlaces.size() == 0}"/>
                                    <ui:repeat var="item" value="#{chosenPlaceBean.guidsOfPlaces}">
                                        <div class="col-12 md:col-6">
                                            <p:card class="bg-gray-50 overflow-auto border-round-2xl">
                                                <div class="text-center">
                                                    <p:graphicImage value="/uploads/profiles/#{item.profileImage}" height="100" width="100" style="border-radius: 50%; border: 2px solid #8c239e"/>
                                                </div>
                                                <div class="text-2xl text-center">#{item.name}</div>
                                                <h:outputText value="(Available)" class="block mb-4 text-center text-green-500 text-base font-normal" rendered="#{!item.isAppointed}"/>
                                                <h:outputText value="(Already appointed)" class="block mb-4 text-red-300 text-base font-normal" rendered="#{item.isAppointed}"/>
                                                <a href="tel:#{item.phoneNumber}" class="flex align-items-center mb-2 text-black-alpha-90" style="text-decoration: none">
                                                    <span class="material-symbols-outlined mr-2" style="font-size: 18px">phone</span>
                                                    <div>#{item.phoneNumber}</div>
                                                </a>
                                                <a href="mailto:#{item.email}" class="flex align-items-center text-black-alpha-90 mb-2" style="text-decoration: none">
                                                    <span class="material-symbols-outlined mr-2" style="font-size: 18px">email</span>
                                                    <div>#{item.email}</div>
                                                </a>
                                                <div class="text-lg text-green-700">
                                                    <div class="flex align-items-center">

                                                        <span class="material-symbols-outlined mr-2 text-black-alpha-80" style="font-size: 18px">payments</span>
                                                        <div class="font-semibold">#{item.amount}</div>
                                                        <span class="material-symbols-outlined pt-1" style="font-size: 14px">currency_rupee</span>
                                                    </div>
                                                </div>
                                                <div class="mt-4">
                                                    <p:commandButton value="Reserve your guide" class="w-full rounded-button ui-button-raised ui-button-help"/>
                                                </div>

                                            </p:card>
                                        </div>
                                    </ui:repeat>
                                </div>
                            </p:tab>
                        </p:tabView>
                    </h:form>
                </div>
            </div>
        </div>

        <p:dialog header="Reserve you place" widgetVar="booking_dialog" class="m-modal" showEffect="fade" modal="true" width="">
            <h:form>
                <p:messages id="msgs" closable="true">
                    <p:autoUpdate/>
                </p:messages>
                <div>
                    <div class="ui-input-icon-left w-full mb-3">
                        <i class="pi pi-user" />
                        <p:inputText placeholder="Provide name" styleClass="w-full block" value="#{beGuideBean.loggedInUser.name}" readonly="true"/>
                    </div>

                    <div class="ui-input-icon-left w-full mb-3">
                        <i class="pi pi-at" />
                        <p:inputText placeholder="example@email.com" styleClass="w-full" value="#{beGuideBean.loggedInUser.email}" readonly="true"/>
                    </div>

                    <div class="ui-input-icon-left w-full mb-3">
                        <i class="pi pi-phone" />
                        <p:inputMask value="#{beGuideBean.loggedInUser.contact}" mask="999 999 9999" styleClass="w-full" readonly="true" />
                    </div>
                    <div class="ui-input-icon-left w-full mb-3">
                        <i class="pi pi-clock" />
                        <p:datePicker id="time" value="#{reservePlace.touristAppointment.startDatetime}" showTime="true" placeholder="Select appointment timing" styleClass="w-full" required="true" requiredMessage="Appointment timeing selection in required"/>
                    </div>
                    <div class="w-full mb-3">
                        <h:outputLabel value="Number of people excluding kids" styleClass="block mb-1"/>
                        <p:spinner value="#{reservePlace.numberOfPeople}" min="0" max="50" placeholder="Number of people excluding kids" downButtonStyleClass="ui-button-help" upButtonStyleClass="ui-button-help" required="true" requiredMessage="Number of people is required" validator="#{validatorBean.validateGoPerson}"/>
                        <small class="mt-1 block">You can take maximum 50 people</small>
                    </div>
                    <div class="w-full mb-3">

                        <p:selectOneRadio id="packSelectionRadio" value="#{reservePlace.pack}">
                            <f:selectItem itemValue="T"/>
                            <f:selectItem itemValue="G" rendered="#{!reservePlace.guidesOfPlace.isEmpty()}"/>
                            <f:selectItem itemValue="TG" rendered="#{!reservePlace.guidesOfPlace.isEmpty()}"/>

                            <f:facet name="custom">
                                <p:outputPanel>
                                    <span class="field-radiobutton" role="radio">
                                        <p:radioButton id="facet1" for="packSelectionRadio" itemIndex="0"/>
                                        <p:outputLabel for="facet1">
                                            <div class="legend">
                                                <div class="text-xl font-semibold mb-2">Transport</div>
                                                <div>Our driver would pick you up from the given location</div>
                                            </div>
                                        </p:outputLabel>
                                    </span>
                                </p:outputPanel>
                                <p:outputPanel rendered="#{!reservePlace.guidesOfPlace.isEmpty()}">
                                    <span class="field-radiobutton" role="radio">
                                        <p:radioButton id="facet2" for="packSelectionRadio" itemIndex="1"/>
                                        <p:outputLabel for="facet2">
                                            <div class="legend">
                                                <div class="text-xl font-semibold mb-2">Guide</div>
                                                <div>You have to select guide</div>
                                            </div>
                                        </p:outputLabel>
                                    </span>
                                </p:outputPanel>
                                <p:outputPanel rendered="#{!reservePlace.guidesOfPlace.isEmpty()}">
                                    <span class="field-radiobutton" role="radio">
                                        <p:radioButton id="facet3" for="packSelectionRadio" itemIndex="2"/>
                                        <p:outputLabel for="facet3">
                                            <div class="legend">
                                                <div class="text-xl font-semibold mb-2">Guide + Transport</div>
                                                <div>Our driver would pick you up from the given location you have to select guide</div>
                                            </div>
                                        </p:outputLabel>
                                    </span>
                                </p:outputPanel>
                            </f:facet>
                        </p:selectOneRadio>
                    </div>

                    <div class="flex flex-wrap justify-content-end">

                        <p:commandButton icon="pi pi-arrow-right" iconPos="right" value="Next" class="rounded-button ui-button-help"/>
                    </div>
                </div>
            </h:form>
        </p:dialog>

    </h:body>
</html>

